<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Eco - Recuerdos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css', v='20260214-4') }}">
</head>
<body class="recuerdos-page">
<div id="zona-recuerdos" class="zona-recuerdos">
  <h1>Ecos</h1>
  {% if error %}
    <p class="mensaje-error" role="alert">{{ error }}</p>
  {% endif %}

  <div class="timeline">
  {% for r in recuerdos %}
    <div class="timeline-item recuerdo recuerdo-card {% if loop.first %}nuevo{% endif %}">
      <div class="timeline-dot"></div>
      <div class="timeline-content">
        <div class="recuerdo-header">
          <strong class="recuerdo-titulo">{{ r.titulo }}</strong>
          <small class="recuerdo-fecha">{{ r.fecha }}</small>
        </div>

        <div class="recuerdo-cancion tarjeta-cancion">
          <div class="cancion-icono">♪</div>
          {% if r.portada %}
            <img src="{{ r.portada }}" alt="Portada de {{ r.cancion }}" class="cancion-portada" loading="lazy" decoding="async">
          {% endif %}
          <div class="cancion-info">
            <div class="cancion-titulo-row">
              <div class="cancion-titulo">{{ r.cancion }}</div>
              {% if r.preview_url %}
                <audio class="recuerdo-preview" controls preload="none" src="{{ r.preview_url }}"></audio>
              {% endif %}
            </div>
            {% if r.artista %}
              <div class="cancion-artista">{{ r.artista }}</div>
            {% endif %}
          </div>
        </div>

        {% if r.nota %}
          <p class="frase-recuerdo">{{ r.nota }}</p>
        {% endif %}
        {% if r.foto_personal %}
          <div class="imagen-recuerdo">
            <img src="{{ url_for('static', filename=r.foto_personal) }}" alt="Foto personal del recuerdo" class="recuerdo-foto" loading="lazy" decoding="async">
          </div>
        {% endif %}
      </div>
    </div>
  {% endfor %}
  </div>
</div>
<button id="nuevo-recuerdo-btn" class="nuevo-recuerdo-btn" type="button" aria-label="Añadir nuevo recuerdo" aria-expanded="false">+</button>

<aside id="nuevo-recuerdo-panel" class="nuevo-recuerdo-panel" aria-hidden="true">
  <div class="nuevo-recuerdo-head">
    <span class="nuevo-recuerdo-handle" aria-hidden="true"></span>
    <h2>Nuevo recuerdo</h2>
    <button id="cerrar-nuevo-recuerdo-btn" class="nuevo-recuerdo-close" type="button" aria-label="Cerrar panel">×</button>
  </div>
  <p class="nuevo-recuerdo-sub">Guarda un momento con su canción, tu frase y una foto.</p>
  <form method="POST" enctype="multipart/form-data" class="nuevo-recuerdo-form">
    <input type="hidden" name="desde_crear" value="{{ '1' if request.args.get('crear') == '1' else '0' }}">
    <label class="nuevo-recuerdo-label" for="cancion">Canción asociada</label>
    <input type="text" id="cancion" name="cancion" placeholder="Busca canción o artista" autocomplete="off">
    <div id="cancion-seleccionada" class="cancion-seleccionada" hidden></div>
    <input type="hidden" name="titulo_cancion">
    <input type="hidden" name="artista">
    <input type="hidden" name="spotify_url">
    <input type="hidden" name="portada">
    <input type="hidden" name="preview_url">
    <label class="nuevo-recuerdo-label" for="nota">Tu frase</label>
    <textarea id="nota" name="nota" placeholder="Tu frase personal para este recuerdo"></textarea>
    <label class="nuevo-recuerdo-label" for="foto_personal">Foto del momento (opcional)</label>
    <input id="foto_personal" type="file" name="foto_personal" accept="image/*">
    <div id="spotify-resultados"></div>
    <div class="nuevo-recuerdo-actions">
      <button id="cancelar-nuevo-recuerdo-btn" type="button" class="nuevo-recuerdo-btn-secundario">Cancelar</button>
      <button type="submit" class="nuevo-recuerdo-btn-primario">Guardar recuerdo</button>
    </div>
  </form>
</aside>
<div id="nuevo-recuerdo-backdrop" class="nuevo-recuerdo-backdrop" aria-hidden="true"></div>
<div id="panel-backdrop" class="panel-backdrop" aria-hidden="true"></div>

<script src="{{ url_for('static', filename='js/recuerdos.js', v='20260214-4') }}"></script>
</body>
</html>
