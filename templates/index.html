{% extends "base.html" %}
{% block title %}Eco · Inicio{% endblock %}
{% block body_class %}inicio-page{% if not current_user.is_authenticated %} inicio-guest{% endif %}{% endblock %}
{% block navhint %}Inicio{% endblock %}
{% block extra_head %}
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
{% endblock %}
{% block extra_css %}
  .wrap{display:block;min-height:100vh;padding:0}
  .card{width:100%;border:0;background:transparent;backdrop-filter:none;box-shadow:none;border-radius:0}
  .topbar,.footer{display:none}
  .inner{padding:0}

  /* =========================
     HOME (index) - Mobile first polish
     ========================= */
  .inicio-hub{
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    gap: 14px;
    padding: 18px 16px;
  }

  /* Hero: menos aire y texto mas compacto */
  .inicio-hero{
    text-align: center;
    padding-top: 6px;
  }

  .inicio-kicker{
    margin: 6px 0 6px;
    letter-spacing: .28em;
    text-transform: uppercase;
    opacity: .65;
    font-size: 12px;
  }

  .inicio-subtitulo{
    margin: 0 auto;
    max-width: 26ch;
    font-size: 26px;
    line-height: 1.15;
    font-weight: 400;
    opacity: .92;
  }

  .inicio-susurro{
    margin: 10px auto 0;
    max-width: 34ch;
    font-size: 13px;
    line-height: 1.45;
    color: rgba(244,241,234,.70);
  }

  /* Auth: tap-friendly + sticky sutil */
  .inicio-auth{
    position: sticky;
    top: 10px;
    z-index: 50;
    display: flex;
    justify-content: center;
    gap: 10px;
    padding: 8px 10px;
  }

  .inicio-auth-link,
  .inicio-auth-btn{
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 44px;
    padding: 10px 14px;
    border-radius: 999px;
    border: 1px solid rgba(244,241,234,.18);
    background: rgba(244,241,234,.06);
    color: rgba(244,241,234,.92);
    font-size: 15px;
    text-decoration: none;
    -webkit-tap-highlight-color: transparent;
  }

  .inicio-auth-link:active,
  .inicio-auth-btn:active{
    transform: scale(.98);
  }

  /* Ajuste del saludo usuario para no romper el layout */
  .inicio-user{
    align-self: center;
    font-size: 13px;
    color: rgba(244,241,234,.75);
    padding: 8px 10px;
  }

  /* Zona tocadiscos: sube el bloque y ocupa mas pantalla util */
  .tocadiscos-placeholder{
    display: flex;
    justify-content: center;
    align-items: center;
    padding-bottom: calc(18px + env(safe-area-inset-bottom));
  }

  /* Tarjeta del tocadiscos (deck) */
  .deck.deck-real{
    width: min(520px, 100%);
    border-radius: 24px;
    overflow: hidden;
    border: 1px solid rgba(244,241,234,.12);
    background: rgba(11,15,26,.35);
    box-shadow: 0 18px 50px rgba(0,0,0,.35);
    position: relative;
  }

  .deck.deck-real::after{
    content:"";
    position:absolute;
    inset:0;
    background: radial-gradient(320px 220px at 50% 30%, rgba(145,120,255,.10), transparent 60%);
    pointer-events:none;
  }

  /* Imagen: que se vea protagonista en movil */
  .deck-image{
    width: 100%;
    height: auto;
    display: block;
    object-fit: cover;
    transform: scale(1.03);
    user-select: none;
  }

  /* Boton central "Biblioteca" */
  .deck-center-btn{
    position: absolute;
    inset: 0;
    margin: auto;
    width: 170px;
    height: 56px;
    border-radius: 999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    letter-spacing: .18em;
    text-transform: uppercase;
    color: rgba(244,241,234,.92);
    border: 1px solid rgba(244,241,234,.20);
    background: rgba(0,0,0,.22);
    backdrop-filter: blur(8px);
  }

  /* FAB: accesible + safe area + sombra */
  .home-fab.deck-fab{
    position: absolute;
    right: 16px;
    bottom: calc(16px + env(safe-area-inset-bottom));
    width: 58px;
    height: 58px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    line-height: 1;
    text-decoration: none;
    border: none;
    background: #f2d34f;
    color: #111;
    box-shadow: 0 16px 38px rgba(0,0,0,.40);
  }

  /* Chips en vez de cards: look app */
  .inicio-accesos{
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
    margin: 18px 0 8px;
  }

  .inicio-chip{
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 14px 16px;
    border-radius: 999px;
    border: 1px solid rgba(244,241,234,.14);
    background: rgba(244,241,234,.05);
    color: rgba(244,241,234,.92);
    text-decoration: none;
    backdrop-filter: blur(12px);
    transition: transform .08s ease, background .2s ease;
  }

  .inicio-chip:active{ transform: scale(.97); }

  .inicio-chip-ico{
    width: 28px;
    height: 28px;
    border-radius: 999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    background: rgba(244,241,234,.08);
    border: 1px solid rgba(244,241,234,.12);
  }

  .inicio-chip-texto{
    font-size: 14px;
    letter-spacing: .02em;
  }

  /* Chip principal */
  .inicio-chip-primary{
    border-color: rgba(155,44,44,.35);
    background: rgba(155,44,44,.18);
    font-weight: 500;
  }

  .inicio-gate{
    min-height: 72vh;
    display:flex;
    flex-direction: column;
    align-items:center;
    justify-content:center;
    text-align:center;
    gap: 14px;
    padding: 18px 14px;
  }

  .inicio-gate-logo{
    width: clamp(96px, 18vw, 142px);
    height: clamp(96px, 18vw, 142px);
    object-fit: contain;
    opacity: .96;
    margin-bottom: 8px;
    filter: drop-shadow(0 10px 24px rgba(0,0,0,.34));
  }

  .inicio-gate-actions{
    width: min(360px, 100%);
    display:grid;
    grid-template-columns: 1fr;
    gap: 10px;
    margin-top: 8px;
  }

  .inicio-gate-btn{
    min-height: 46px;
    border-radius: 999px;
    border: 1px solid rgba(244,241,234,.18);
    background: rgba(244,241,234,.06);
    color: rgba(244,241,234,.92);
    display:flex;
    align-items:center;
    justify-content:center;
    text-decoration:none;
    font-size: 15px;
    -webkit-tap-highlight-color: transparent;
  }

  .inicio-gate-btn:active{ transform: scale(.98); }

  .inicio-gate-btn-primary{
    border-color: rgba(155,44,44,.40);
    background: rgba(155,44,44,.18);
  }

  .inicio-gate-mini{
    margin-top: 10px;
    max-width: 34ch;
    color: rgba(244,241,234,.62);
    font-size: 12.5px;
    line-height: 1.45;
  }

  /* =========================
     Movil: recorta el aire muerto general
     ========================= */
  @media (max-width: 520px){
    body.inicio-page:not(.inicio-guest){
      background:
        radial-gradient(900px 460px at 50% 34%, rgba(167,108,72,.18), rgba(12,16,36,0) 62%),
        radial-gradient(700px 520px at 50% 85%, rgba(198,108,72,.16), rgba(12,16,36,0) 70%),
        linear-gradient(180deg, #0a0f23 0%, #090d1d 46%, #070a16 100%);
    }

    body.inicio-page:not(.inicio-guest) .inicio-hub{
      gap: 10px;
      padding: 14px 16px 20px;
    }

    body.inicio-page:not(.inicio-guest) .inicio-auth{
      display: none;
    }

    body.inicio-page:not(.inicio-guest) .inicio-hero{
      padding-top: 8px;
    }

    body.inicio-page:not(.inicio-guest) .inicio-kicker{
      font-size: 11px;
      letter-spacing: .36em;
      margin: 2px 0 6px;
      opacity: .78;
    }

    body.inicio-page:not(.inicio-guest) .inicio-kicker::before{
      content: "☾";
      display: block;
      font-size: 34px;
      line-height: 1;
      margin-bottom: 10px;
      letter-spacing: 0;
      opacity: .82;
    }

    body.inicio-page:not(.inicio-guest) .inicio-subtitulo{
      font-size: 18px !important;
      line-height: 1.22;
      max-width: 17ch;
      margin: 0 auto 6px !important;
    }

    /* 1) Hero más compacto */
    .inicio-hero{ padding-top: 4px; }
    .inicio-subtitulo{
      font-size: 22px;
      line-height: 1.15;
      max-width: 22ch;
      margin: 6px auto 10px;
    }

    /* 2) Oculta el saludo largo, deja solo botón salir/cuenta (temporal) */
    .inicio-user{ display:none; }

    /* 3) Tocadiscos más protagonista */
    .tocadiscos-placeholder{ margin-top: 6px; }
    .deck.deck-real{
      border-radius: 22px;
    }

    /* 4) Quita el botón “Biblioteca” encima de la imagen (queda redundante) */
    .deck-center-btn{ display:none; }

    /* 5) FAB más discreto */
    .home-fab.deck-fab{
      width: 52px;
      height: 52px;
      font-size: 24px;
      right: 14px;
      bottom: calc(14px + env(safe-area-inset-bottom));
      background: rgba(244,241,234,.92);
      color: #0b0f1a;
      box-shadow: 0 14px 30px rgba(0,0,0,.35);
    }
  }

  /* Móvil */
  @media (max-width: 520px){
    .inicio-gate-logo{
      width: 120px;
      height: 120px;
    }

    .inicio-accesos{
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin: 14px 0 6px;
    }

    .inicio-chip{
      width: 100%;
      justify-content: center;
      min-height: 56px;
      padding: 14px 18px;
    }

    .inicio-chip-primary{
      order: -1;
    }
  }

  @media (max-width: 520px){

    /* 1) Quita sensación de “tarjeta web”: tocadiscos a todo el ancho */
    .tocadiscos-placeholder{
      padding: 0 !important;
      margin: 8px -16px 2px; /* -16 asumiendo padding lateral del main */
      align-items: flex-start;
    }

    /* 2) El contenedor del deck sin borde, sin marco, y con forma “app” */
    .deck.deck-real{
      border: 0 !important;
      background: transparent !important;
      box-shadow: none !important;
      border-radius: 0 !important;
      overflow: hidden;
      position: relative;
    }

    /* 3) Imagen: encuadre mejor para móvil (menos “vacío” arriba) */
    .deck-image{
      width: 100%;
      height: 58vh;
      min-height: 360px;
      max-height: 60vh;
      object-fit: cover;
      object-position: 50% 52%;
      display: block;
      transform: none !important;
    }

    /* 4) Capa sutil para legibilidad (sin parecer overlay web) */
    .deck.deck-real::after{
      display: none;
    }

    /* 5) El botón Biblioteca encima ahora mismo parece web. Lo convertimos en “toca para entrar” */
    .deck-center-btn{
      display: none !important;
    }

    /* 6) FAB más “Eco”: menos amarillo chirriante y menos invasivo */
    .home-fab.deck-fab{
      display: none !important;
    }

    /* 7) Reduce el texto grande: deja que la imagen mande */
    .inicio-kicker{
      font-size: 11px;
      margin: 4px 0 4px;
    }

    .inicio-subtitulo{
      font-size: 19px !important;
      max-width: 20ch;
      margin: 4px auto 6px !important;
    }

    body.inicio-page:not(.inicio-guest) .tocadiscos-placeholder{
      margin: 0 -16px 4px;
    }

    body.inicio-page:not(.inicio-guest) .deck-image{
      height: 57vh;
      min-height: 350px;
      max-height: 59vh;
      object-position: 50% 50%;
    }

    body.inicio-page:not(.inicio-guest) .inicio-accesos{
      width: min(360px, calc(100vw - 32px));
      margin: 10px auto 2px;
      gap: 10px;
    }

    body.inicio-page:not(.inicio-guest) .inicio-chip{
      min-height: 58px;
      padding: 0 18px;
      justify-content: flex-start;
      border: 1px solid rgba(244,241,234,.2);
      background: rgba(7,11,26,.46);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }

    body.inicio-page:not(.inicio-guest) .inicio-chip-primary{
      background: linear-gradient(180deg, rgba(125,38,58,.6), rgba(86,23,42,.72));
      border-color: rgba(209,104,122,.42);
    }

    body.inicio-page:not(.inicio-guest) .inicio-chip-ico{
      width: 30px;
      height: 30px;
      border: 1px solid rgba(244,241,234,.26);
      background: rgba(244,241,234,.08);
      font-size: 13px;
    }

    body.inicio-page:not(.inicio-guest) .inicio-chip-texto{
      font-size: 13px;
      letter-spacing: .12em;
      text-transform: uppercase;
    }
  }

  @media (min-width: 900px){
    .inicio-subtitulo{
      font-size: 30px;
      max-width: 32ch;
    }
  }
{% endblock %}

{% block content %}
  <main class="inicio-hub">
    {% if not current_user.is_authenticated %}

      <section class="inicio-gate" aria-label="Acceso">
        <img
          src="{{ url_for('static', filename='images/image_eco.png') }}"
          alt="Eco"
          class="inicio-gate-logo"
          draggable="false"
        >
        <p class="inicio-kicker">Eco</p>
        <p class="inicio-subtitulo">Una canción puede guardar un momento entero.</p>

        <div class="inicio-gate-actions">
          <a href="{{ url_for('auth.login') }}" class="inicio-gate-btn">Entrar</a>
          <a href="{{ url_for('auth.register') }}" class="inicio-gate-btn inicio-gate-btn-primary">Registrarse</a>
        </div>

        <p class="inicio-gate-mini">
          Guarda lo que no quieres olvidar.<br>
          Y lo que aún no estás lista para volver a escuchar.
        </p>
      </section>

    {% else %}

      <!-- TODO: tu home actual con tocadiscos + chips -->
      <section class="inicio-hero">
        <div class="inicio-auth">
          <span class="inicio-user">Hola, {{ current_user.email }}</span>
          <form method="post" action="{{ url_for('auth.logout') }}" class="inicio-auth-form">
            <button type="submit" class="inicio-auth-link inicio-auth-btn">Salir</button>
          </form>
        </div>
        <p class="inicio-kicker">Eco</p>
        <p class="inicio-subtitulo">Una canción puede guardar un momento entero.</p>
      </section>

      <section class="tocadiscos-placeholder" aria-label="Zona reservada para tocadiscos 3D">
        <div class="deck deck-real">
          <img src="{{ url_for('static', filename='portada_eco.jpg') }}" alt="Tocadiscos 3D de Eco" class="deck-image" draggable="false">
          <img 
            src="{{ url_for('static', filename='vinilo_eco.png') }}" 
            class="deck-vinilo" 
            alt="Vinilo Eco"
            draggable="false">
          <a href="{{ url_for('main.biblioteca') }}" class="deck-center-btn" aria-label="Entrar a biblioteca">Biblioteca</a>
        </div>
      </section>

      <!-- chips (opción 2) -->
      <section class="inicio-accesos" aria-label="Accesos principales">
        <a class="inicio-chip inicio-chip-primary" href="{{ url_for('main.recuerdos', crear=1) }}">
          <span class="inicio-chip-ico">✎</span>
          <span class="inicio-chip-texto">Nuevo recuerdo</span>
        </a>

        <a class="inicio-chip" href="{{ url_for('main.biblioteca') }}">
          <span class="inicio-chip-ico">⟡</span>
          <span class="inicio-chip-texto">Biblioteca</span>
        </a>

        <a class="inicio-chip" href="{{ url_for('main.capsulas_panel') }}">
          <span class="inicio-chip-ico">⏳</span>
          <span class="inicio-chip-texto">Cápsulas</span>
        </a>
      </section>

    {% endif %}
  </main>
{% endblock %}

{% block extra_js %}
  <script>
  (function(){
    const el = document.getElementById("inicioSusurro");
    if(!el) return;

    const lines = [
      "Algunas canciones esperan.",
      "Hay recuerdos que suenan mejor de noche.",
      "No todo lo que guardas quiere abrirse hoy.",
      "El tiempo también escucha.",
      "Guarda lo que no quieres olvidar.",
      "A veces, volver a escuchar es volver a ser."
    ];

    // “Sorpresa estable” por día: cambia cada día, no cada recarga
    const now = new Date();
    const key = Number(String(now.getFullYear()) + String(now.getMonth()+1).padStart(2,"0") + String(now.getDate()).padStart(2,"0"));
    const idx = key % lines.length;

    el.textContent = lines[idx];
    if (now.getHours() >= 23 || now.getHours() < 6) {
      el.textContent = "Eco escucha mejor a estas horas.";
    }
  })();
  </script>
  <script src="{{ url_for('static', filename='js/inicio.js') }}"></script>
{% endblock %}
