{% extends "base.html" %}
{% block title %}Eco · Inicio{% endblock %}
{% block body_class %}inicio-page{% if not current_user.is_authenticated %} inicio-guest{% endif %}{% endblock %}
{% block navhint %}Inicio{% endblock %}
{% block extra_head %}
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
{% endblock %}
{% block extra_css %}
  .wrap{display:block;min-height:100vh;padding:0}
  .card{width:100%;border:0;background:transparent;backdrop-filter:none;box-shadow:none;border-radius:0}
  .topbar,.footer{display:none}
  .inner{padding:0}

  /* =========================
     HOME (index) - Mobile first polish
     ========================= */
  .inicio-hub{
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    gap: 14px;
    padding: 18px 16px;
  }

  /* Hero: menos aire y texto mas compacto */
  .inicio-hero{
    text-align: center;
    padding-top: 6px;
  }

  .inicio-kicker{
    margin: 6px 0 6px;
    letter-spacing: .28em;
    text-transform: uppercase;
    opacity: .65;
    font-size: 12px;
  }

  .inicio-subtitulo{
    margin: 0 auto;
    max-width: 26ch;
    font-size: 26px;
    line-height: 1.15;
    font-weight: 400;
    opacity: .92;
  }

  .inicio-susurro{
    margin: 10px auto 0;
    max-width: 34ch;
    font-size: 13px;
    line-height: 1.45;
    color: rgba(244,241,234,.70);
  }

  /* Auth: tap-friendly + sticky sutil */
  .inicio-auth{
    position: sticky;
    top: 10px;
    z-index: 50;
    display: flex;
    justify-content: center;
    gap: 10px;
    padding: 8px 10px;
  }

  .inicio-auth-link,
  .inicio-auth-btn{
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 44px;
    padding: 10px 14px;
    border-radius: 999px;
    border: 1px solid rgba(244,241,234,.18);
    background: rgba(244,241,234,.06);
    color: rgba(244,241,234,.92);
    font-size: 15px;
    text-decoration: none;
    -webkit-tap-highlight-color: transparent;
  }

  .inicio-auth-link:active,
  .inicio-auth-btn:active{
    transform: scale(.98);
  }

  /* Ajuste del saludo usuario para no romper el layout */
  .inicio-user{
    align-self: center;
    font-size: 13px;
    color: rgba(244,241,234,.75);
    padding: 8px 10px;
  }

  /* Zona tocadiscos: sube el bloque y ocupa mas pantalla util */
  .tocadiscos-placeholder{
    display: flex;
    justify-content: center;
    align-items: center;
    padding-bottom: calc(18px + env(safe-area-inset-bottom));
  }

  /* Tarjeta del tocadiscos (deck) */
  .deck.deck-real{
    width: min(520px, 100%);
    border-radius: 24px;
    overflow: hidden;
    border: 1px solid rgba(244,241,234,.12);
    background: rgba(11,15,26,.35);
    box-shadow: 0 18px 50px rgba(0,0,0,.35);
    position: relative;
  }

  .deck.deck-real::after{
    content:"";
    position:absolute;
    inset:0;
    background: radial-gradient(320px 220px at 50% 30%, rgba(145,120,255,.10), transparent 60%);
    pointer-events:none;
  }

  /* Imagen: que se vea protagonista en movil */
  .deck-image{
    width: 100%;
    height: auto;
    display: block;
    object-fit: cover;
    transform: scale(1.03);
    user-select: none;
  }

  /* Boton central "Biblioteca" */
  .deck-center-btn{
    position: absolute;
    inset: 0;
    margin: auto;
    width: 170px;
    height: 56px;
    border-radius: 999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    letter-spacing: .18em;
    text-transform: uppercase;
    color: rgba(244,241,234,.92);
    border: 1px solid rgba(244,241,234,.20);
    background: rgba(0,0,0,.22);
    backdrop-filter: blur(8px);
  }

  /* FAB: accesible + safe area + sombra */
  .home-fab.deck-fab{
    position: absolute;
    right: 16px;
    bottom: calc(16px + env(safe-area-inset-bottom));
    width: 58px;
    height: 58px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    line-height: 1;
    text-decoration: none;
    border: none;
    background: #f2d34f;
    color: #111;
    box-shadow: 0 16px 38px rgba(0,0,0,.40);
  }

  /* =========================
     Movil: recorta el aire muerto general
     ========================= */
  @media (max-width: 520px){
    /* 1) Hero más compacto */
    .inicio-hero{ padding-top: 4px; }
    .inicio-subtitulo{
      font-size: 22px;
      line-height: 1.15;
      max-width: 22ch;
      margin: 6px auto 10px;
    }

    /* 2) Oculta el saludo largo, deja solo botón salir/cuenta (temporal) */
    .inicio-user{ display:none; }

    /* 3) Tocadiscos más protagonista */
    .tocadiscos-placeholder{ margin-top: 6px; }
    .deck.deck-real{
      border-radius: 22px;
    }

    /* 4) Quita el botón “Biblioteca” encima de la imagen (queda redundante) */
    .deck-center-btn{ display:none; }

    /* 5) FAB más discreto */
    .home-fab.deck-fab{
      width: 52px;
      height: 52px;
      font-size: 24px;
      right: 14px;
      bottom: calc(14px + env(safe-area-inset-bottom));
      background: rgba(244,241,234,.92);
      color: #0b0f1a;
      box-shadow: 0 14px 30px rgba(0,0,0,.35);
    }
  }

  @media (min-width: 900px){
    .inicio-subtitulo{
      font-size: 30px;
      max-width: 32ch;
    }
  }
{% endblock %}

{% block content %}
  <main class="inicio-hub">
    <section class="inicio-hero">
      <div class="inicio-auth">
        {% if current_user.is_authenticated %}
          <span class="inicio-user">Hola, {{ current_user.email }}</span>
          <form method="post" action="{{ url_for('auth.logout') }}" class="inicio-auth-form">
            <button type="submit" class="inicio-auth-link inicio-auth-btn">Salir</button>
          </form>
        {% else %}
          <a href="{{ url_for('auth.login') }}" class="inicio-auth-link">Entrar</a>
          <a href="{{ url_for('auth.register') }}" class="inicio-auth-link">Registrarse</a>
        {% endif %}
      </div>
      <p class="inicio-kicker">Eco</p>
      <p class="inicio-subtitulo">Una canción puede guardar un momento entero.</p>
      <p class="inicio-susurro" id="inicioSusurro"></p>
    </section>

    <section class="tocadiscos-placeholder" aria-label="Zona reservada para tocadiscos 3D">
      <div class="deck deck-real">
        <img src="{{ url_for('static', filename='portada_eco.jpg') }}" alt="Tocadiscos 3D de Eco" class="deck-image" draggable="false">
        <a href="{{ url_for('main.biblioteca') }}" class="deck-center-btn" aria-label="Entrar a biblioteca">Biblioteca</a>
        <a href="{{ url_for('main.recuerdos', crear=1) }}" class="home-fab deck-fab" aria-label="Crear nuevo recuerdo">＋</a>
      </div>
    </section>

    {% if current_user.is_authenticated %}
      <section class="inicio-accesos" aria-label="Accesos principales">
        <a class="inicio-card" href="{{ url_for('main.biblioteca') }}">
          <span class="inicio-card-titulo">Biblioteca</span>
          <span class="inicio-card-texto">Ver todos tus recuerdos.</span>
        </a>
        <a class="inicio-card" href="{{ url_for('main.recuerdos', crear=1) }}">
          <span class="inicio-card-titulo">Nuevo recuerdo</span>
          <span class="inicio-card-texto">Guardar un momento en un toque.</span>
        </a>
        <a class="inicio-card" href="{{ url_for('main.capsulas_panel') }}">
          <span class="inicio-card-titulo">Cápsulas</span>
          <span class="inicio-card-texto">Programar y abrir cápsulas.</span>
        </a>
      </section>
    {% endif %}
  </main>
  <button id="ritualAudioToggle" class="home-audio-toggle" type="button" aria-pressed="true">Sonido: ON</button>
{% endblock %}

{% block extra_js %}
  <script>
  (function(){
    const el = document.getElementById("inicioSusurro");
    if(!el) return;

    const lines = [
      "Algunas canciones esperan.",
      "Hay recuerdos que suenan mejor de noche.",
      "No todo lo que guardas quiere abrirse hoy.",
      "El tiempo también escucha.",
      "Guarda lo que no quieres olvidar.",
      "A veces, volver a escuchar es volver a ser."
    ];

    // “Sorpresa estable” por día: cambia cada día, no cada recarga
    const now = new Date();
    const key = Number(String(now.getFullYear()) + String(now.getMonth()+1).padStart(2,"0") + String(now.getDate()).padStart(2,"0"));
    const idx = key % lines.length;

    el.textContent = lines[idx];
    if (now.getHours() >= 23 || now.getHours() < 6) {
      el.textContent = "Eco escucha mejor a estas horas.";
    }
  })();
  </script>
  <script src="{{ url_for('static', filename='js/inicio.js') }}"></script>
{% endblock %}
